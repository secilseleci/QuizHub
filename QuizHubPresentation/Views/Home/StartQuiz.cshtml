@model QuizDtoForUser


<div class="container mt-5">
    <div class="card shadow">
        <div class="card-header d-flex justify-content-between align-items-center">
            <h5 class="mb-0">Quiz App</h5>


        </div>

        <div class="card-body">


            <h4 class="card-title my-3" id="questionText">@Model.Questions.First().QuestionText</h4>

            <div class="list-group mt-3" id="optionsList">
                @foreach (var option in Model.Questions.First().Options)
                {
                    <label class="list-group-item d-flex align-items-center">
                        <input type="radio" name="questionOptions" value="@option.OptionId" class="me-2">
                        <span>@option.OptionText</span>
                    </label>
                }
            </div>
        </div>

        <div class="card-footer d-flex justify-content-between">
            <span id="questionOrder">@Model.Questions.First().Order / @Model.QuestionCount</span>    
            <button class="btn btn-warning" id="finishButton" style="display:none;">Quizi Bitir</button>


            <button class="btn btn-primary" id="nextButton">Next</button>
        </div>
    </div>
</div>

<script>
     var currentQuestionOrder = @Model.Questions.First().Order;  // İlk sorunun sırası, sayfa yüklendiğinde ayarlanıyor.
    var questionId = @Model.Questions.First().QuestionId;  // İlk sorunun ID'si, ilk yüklemede ayarlanıyor

    // Next butonuna tıklayınca hem cevabı kaydediyoruz hem de sıradaki soruya geçiyoruz
    document.getElementById("nextButton").addEventListener("click", function () {
        var selectedOptionId = $('input[name="questionOptions"]:checked').val();  // Seçilen şık
        var quizId = '@Model.QuizId';  // Quiz ID
 
        if (!selectedOptionId) {
            alert("Lütfen bir seçenek seçin!");
            return;
        }

        // Cevabı kaydetmek için AJAX isteği yapıyoruz
        $.ajax({
            url: '/Home/SaveAnswer',
            method: 'POST',
            data: {
                quizId: quizId,
                questionId: questionId,
                selectedOptionId: selectedOptionId
            },
            success: function (response) {
                nextQuestion();
            },
            error: function (xhr, status, error) {
                console.error("Cevap kaydedilemedi:", error);
            }
        });
    });

     function nextQuestion() {
        var quizId = "@Model.QuizId";  
 
        $.ajax({
            url: '/Home/NextQuestion',
            method: 'POST',
            data: { quizId: quizId, currentQuestionOrder: currentQuestionOrder },   
            success: function (response) {
                if (response.success) {
                     $('#questionText').text(response.questionText);
                    $('#questionOrder').text(response.currentOrder + ' / ' + response.totalQuestions);

                    var optionsList = $('#optionsList');
                    optionsList.empty();  // Eski seçenekleri temizliyoruz
                    response.options.forEach(function (option) {
                        optionsList.append('<label class="list-group-item d-flex align-items-center">' +

                        '<input type="radio" name="questionOptions" value="' + option.id + '" class="me-2">' +   
                            '<span>' + option.text + '</span>' +   
                            '</label>');
                    });

                     currentQuestionOrder = response.currentOrder; 
                    questionId = response.questionId; 

                } 
                else {
                    $('#nextButton').hide();
                    $('#finishButton').show();
                    }
            },
            error: function (xhr, status, error) {
                console.log("AJAX isteği başarısız oldu:", error);
                alert("Bir hata meydana geldi: " + error);
            }
        });
    }

    document.getElementById("finishButton").addEventListener("click", function () {
        window.location.href = "/Home/QuizCompleted";
    });
</script>
